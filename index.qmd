---
title: "Using R to Build a Community Data Explorer for Cincinnati (CoDEC)"
subtitle: "CCHMC R Users Group"
author: "Cole Brokamp, Erika Manning, Andrew Vancil"
date: 2023-05-10
format: 
  revealjs:
    theme: codec.scss
    standalone: true
    embed-resources: true
---

## Welcome

[Join](https://outlook.office365.com/owa/r@cchmc.onmicrosoft.com/groupsubscription.ashx?action=join) the RUG Outlook group for updates and events.
![](figs/join_rug.png){fig-align="center"}{width=180%}

## Upcoming BUG + RUG Event

. . .

## Using R to Build a Community Data Explorer for Cincinnati (CoDEC)

1. Introduction to CoDEC
1. Sharing CoDEC Data
1. Exploring CoDEC Data

# Background

## Equitable Data

The White House's [Equitable Data Working Group](https://www.whitehouse.gov/briefing-room/statements-releases/2022/04/22/fact-sheet-biden-harris-administration-releases-recommendations-for-advancing-use-of-equitable-data/) has defined equitable data as "those that allow for rigorous assessment of the extent to which government programs and policies yield consistently fair, just, and impartial treatment of all individuals." They advise that equitable data should “illuminate opportunities for targeted actions that will result in demonstrably improved outcomes for underserved communities.” The group recommended to make disaggregated data the norm while being "... intentional about when data are collected and shared, as well as how data are protected so as not to exacerbate the vulnerability of members of underserved communities, many of whom face the heightened risk of harm if their privacy is not protected."

The U.S. Chief Data Scientist, Denice Ross, has [declared](https://www.fedscoop.com/us-chief-data-scientist-interview/) that "open data is necessary and *not* sufficient to drive the type of action that we need to create a more equitable society." Open data can fall short of driving action if it is not equitable. [Disaggregating](https://doi.org/10.1377/forefront.20220323.555023) data by sensitive attributes, like race and ethnicity, can elucidate inequities that would otherwise remain hidden.

## Community-Level & Disaggregated Data

[Data are people](https://doi.org/10.1371/journal.pcbi.1005399) and when sharing data, privacy is a spectrum of the
tradeoffs between risks and benefits to individuals and populations. Data collected at the individual-level by one organization often [cannot be shared](https://sharing.nih.gov/data-management-and-sharing-policy/protecting-participant-privacy-when-sharing-scientific-data/principles-and-best-practices-for-protecting-participant-privacy) with another organization due to legal restrictions or organization-specific data governance policies. We are often interested in community-level (e.g. neighborhood, census tract, ZIP code) data disaggregated by gender, race, or other sensitive attributes. Achieving data harmonization upstream of storage allows for contribution of disaggregated, community-level data without disclosing individual-level data when sharing across organizations.

## CoDEC

**Co**mmunity **D**ata **E**xplorer for **C**incinnati (**CoDEC**) is a data repository composed of equitable, community-level data for Cincinnati.

- Data about communities come in different spatiotemporal resolutions and extents and are not designed with the specific goal of integrating with other data.
- CoDEC defines specifications for community-level data in an effort to make them more [FAIR](https://doi.org/10.1038/sdata.2016.18).
- Common data specification for organizations means that organizations can more easily use methods and tools for harmonizing, storing, accessing, and *sharing* community-level data.
- {[codec](https://github.com/geomarker-io/codec)} R package to describe, curate, and check against CoDEC specifications 

Using these tools, a collection of extant community-level data resources is automatically transformed into a harmonized, community-level tabular data package that is openly available and accompanied by:

1. a richly-documented data catalog
2. a web-based interface for exploring and learning from data
3. an API for accessing data at scale and on demand

## CoDEC Overview

```{mermaid}
%%{init: { "fontFamily": "arial" } }%%

flowchart LR

classDef I fill:#E49865,stroke:#333,stroke-width:0px;
classDef II fill:#EACEC5,stroke:#333,stroke-width:0px;
classDef III fill:#CBD6D5,stroke:#333,stroke-width:0px;
classDef IIII fill:#8CB4C3,stroke:#333,stroke-width:0px;
classDef V fill:#396175,color:#F6EAD8,stroke:#333,stroke-width:0px;

subgraph source-box [data sources]
    org(community \norganization):::I
    jfs(government \n organization):::I
    cchmc("healthcare \n organization"):::I
    acs("built, natural, and \n social environment"):::I
end
class source-box II

stage(collection of community-\nlevel data):::I

org --> |"data \n support"| stage
jfs --> |decentralized \n geocoding| stage
cchmc --> |spatiotemporal \n aggregation| stage
acs --> |automatic \n interpolation| stage
stage --> codec-box

subgraph codec-box ["Community Data Explorer for Cincinnati (CoDEC)"]
    ingest("(meta)data harmonization"):::IIII
    data(community-level \n tabular data resource):::IIII
    data-catalog("interactive data catalog\n geomarker.io/codec"):::IIII
    ingest --> data
    data --> data-catalog
    data --> api(data API):::IIII
    api --> bindings(R code \n for accessing data):::IIII
    data-catalog --> download(explore, map, download):::V
end

class codec-box III

bindings --> dashboard("dashboards and reports"):::V
bindings --> qr(QI & research):::V
api ---> anywhere(public access):::V
```

## Data Harmonization

- [CoDEC](https://en.wikipedia.org/wiki/Codec) encodes data streams about the communities in which we live into a common format (census tract and month) so that it can be decoded into different community-level geographies and different time frames.

```{r}
#| out.width: 5in
#| dpi: 300
#| fig.align: right
knitr::include_graphics("https://geomarker.io/codec/reference/figures/codec_harmonization.svg")
```

## FAIR


- 🔎 findable: use a unique and persistent identifier, add rich metadata (using[existing standards](https://rd-alliance.github.io/metadata-directory/standards/))
- 🔓 accessible: store in a data repository ( ⚠️ personal/classified information, but metadata still accessible)
- ⚙️ interoperable: use an open file format with controlled vocabularies, reference relevant datasets
- ♻️ reusable: good documentation including a README (with project background, organization of files, and how to reproduce the project) and a data dictionary (with variable explainations, measurement units, how missingness is encoded, etc); usage licenses (for [code](https://choosealicense.com/licenses/) or [data/presentations/papers](https://creativecommons.org/about/cclicenses/)) 


## TRUST

- 🤲 transparent: make specific repository services and data holdings verifiable by publicly accessible evidence
- 📃 responsible: ensure authenticity and integrity of data holdings
- 👥 user-focused: meet data management norms and expectations of target user communities
- ⏳️️ sustainable: preserve services and data holdings for the long-term
- ⚙️ technological: provide infrastructure and capabilities supporting secure, persistent, and reliable services

- transparent: make specific repository services and data holdings verifiable by publicly accessible evidence
- responsible: ensure authenticity and integrity of data holdings
- user-focused: meet data management norms and expectations of target user communities
- ️sustainable: preserve services and data holdings for the long-term
-  technological: provide infrastructure and capabilities supporting secure, persistent, and reliable services

Creating and maintaining an open community-level data resource equips the entire community for data-powered decision making *and* boosts organizational trustworthiness. Demonstrating reliability and capability of appropriately managing shared data helps earn the [trust](https://doi.org/10.1038/s41597-020-0486-7) of organizations and communities intended to be served.

## CoDEC Data Available Now

https://geomarker.io/codec/articles/data.html

- [Census Tract-Level Neighborhood
  Indices](https://github.com/geomarker-io/tract_indices)
- [Harmonized Historical American Community Survey
  Measures](https://github.com/geomarker-io/hh_acs_measures)
- [Hamilton County Property Code
  Enforcement](https://github.com/geomarker-io/hamilton_property_code_enforcement)
- [Hamilton County Drive Time to
  CCHMC](https://github.com/geomarker-io/hamilton_drivetime)
- [Hamilton County Land Cover and Built
  Environment](https://github.com/geomarker-io/hamilton_landcover)
- [Hamilton County Parcel and Household
  Traffic](https://github.com/geomarker-io/hamilton_traffic)

## How to Read Data in R Using CoDEC

```r
codec::codec_data("hamilton_property_code_enforcement")
```

## How to Read Metadata in R Using CoDEC

```r
codec::codec_data("hamilton_property_code_enforcement") |>
  codec::glimpse_tdr()
```

# Sharing CoDEC Data

## Frictionless Standards

## CoDEC-Specific Specifications

https://geomarker.io/codec/articles/specs.html

```{mermaid}
%%{init: { "fontFamily": "Arial" } }%%

flowchart TB

classDef I fill:#E49865,stroke:#333,stroke-width:2px;
classDef II fill:#EACEC5,stroke:#333,stroke-width:2px;
classDef III fill:#CBD6D5,stroke:#333,stroke-width:2px;
classDef IIII fill:#8CB4C3,stroke:#333,stroke-width:2px;

tdr([tabular-data-resource]):::I

name(name):::II
path(path):::II
version(version):::II   
schema([schema]):::II
title(title):::II
homepage(homepage):::II
description(description):::II

tdr --- name
tdr --- path
tdr --- version   
tdr --- title
tdr --- description
tdr --- homepage
tdr --- schema

schema --- fields([fields]):::III
schema --- primaryKey(primaryKey):::III
schema --- foreignKey(foreignKey):::III

fields --- field_name_1(field_1:\nname \n title \n description \n type):::IIII
fields --- field_name_2(field_2:\nname \n title \n type \n constraints):::IIII
fields --- field_name_3(field_3:\nname \n title \n description \n type \n constraints):::IIII
```

## {cincy}

- CoDEC relies on the {[cincy](https://geomarker.io/cincy/index.html)} R package to define Cincinnati-area [geographies](https://geomarker.io/cincy/articles/geographies.html) and [interpolate](https://geomarker.io/cincy/articles/interpolate.html) area-level data between census tracts, neighborhoods, and ZIP codes in different years.

## `CoDEC`

The goal of the R package {codec} is to support [CoDEC](https://geomarker.io/codec) data
infrastructure through:

- curating metadata for tabular data in R:
  `vignette("curating-metadata")`
- reading and writing tabular-data-resources:
  `vignette("reading-writing-tdr")`
- defining the CoDEC tabular-data-resource specifications:
  `vignette("specs")`
- providing tools to check CoDEC tabular-data-resources and create an
  interactive data catalog: `vignette("data")`
  
## Curating metadata for tabular data in R using attributes

https://geomarker.io/codec/articles/curating-metadata.html
  
## Reading and writing tabular data resources

https://geomarker.io/codec/articles/reading-writing-tdr.html

## Tools for Checking Against CoDEC Specifications

https://geomarker.io/codec/reference/check_codec_tdr_csv.html

# Exploring CoDEC

## Leveraging data standards for shiny?

## Screenshot

## Shiny

## Inset panel and scatterplot

## bslib layout

## "crosstalk" hack

## Interactive Demo

# Conclusions

## R ...

- curate data, metadata, visualizations all in one language


## Thank You

🌐 [https://geomarker.io/codec](https://geomarker.io/codec)

‍💻️ [github.com/geomarker-io](https://github.com/geomarker-io)
